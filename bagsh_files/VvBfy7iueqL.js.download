if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("LSLocalApplyOptimisticGroupThread",["LSArrayGetObjectAt","LSCreateOfflineThreadingID","LSGetViewerFBID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(f){return c.seq([function(a){return c.sp(b("LSCreateOfflineThreadingID"),c.i64.of_float(Date.now())).then(function(a){return a=a,d[0]=a[0],a})},function(a){return d[1]=[64,1083495711],d[2]=[0,0],d[3]=[0,0],c.sp(b("LSGetViewerFBID")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.fe(c.ftr(c.db.table(9).fetch([[[d[0]]]]),function(a){return c.i64.eq(a.threadKey,d[0])&&c.i64.lt(a.authorityLevel,[0,20])}),function(a){return a["delete"]()})},function(b){return c.db.table(9).add({threadKey:d[0],mailboxType:[0,0],threadType:[0,2],clientThreadKey:d[0],folderName:"inbox",parentThreadKey:[0,0],lastActivityTimestampMs:[0,0],lastReadWatermarkTimestampMs:[0,0],snippetHasEmoji:!1,snippetSenderContactId:d[4],ongoingCallState:[0,0],authorityLevel:[0,20],capabilities:d[1],capabilities2:d[2],capabilities3:d[3],nullstateDescriptionText1:a[1],threadName:a[2]})},function(e){return d[5]=c.i64.of_int32(a[0].length),c.i64.gt(d[5],[0,0])?c.loopAsync(d[5],function(e){return d[6]=e,c.seq([function(e){return c.ntop("Array",b("LSArrayGetObjectAt"),a[0],d[6]).then(function(a){return a=a,d[7]=a[0],d[8]=a[1],a})},function(a){return c.fe(c.ftr(c.db.table(14).fetch([[[d[0],d[7]]]]),function(a){return c.i64.eq(a.threadKey,d[0])&&c.i64.eq([0,0],[0,0])&&c.i64.eq(a.contactId,d[7])&&c.i64.lt(a.authorityLevel,[0,20])}),function(a){return a["delete"]()})},function(a){return c.db.table(14).add({threadKey:d[0],contactId:d[7],readWatermarkTimestampMs:[0,0],deliveredWatermarkTimestampMs:[0,0],authorityLevel:[0,20],isModerator:!1})}])}):c.resolve()},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSLocalCreateOptimisticGroupThread",["LSIssueNewTask","LSLocalApplyOptimisticGroupThread"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.sp(b("LSLocalApplyOptimisticGroupThread"),a[0],a[1],f).then(function(a){return a=a,d[0]=a[0],a})},function(e){return a[2]===!0?(d[1]=new c.Map(),d[1].set("participants",a[0]),d[1].set("client_thread_key",d[0]),d[1].set("sync_group",[0,1]),d[2]=d[1].get("client_thread_key"),d[1],d[3]=c.toJSON(d[1]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[2]),[0,153],d[3],f,f,[0,0],[0,0],f,f,[0,0])):c.resolve()},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("MWLink.react",["MAWArmadilloLink.re","MAWArmadilloLink.react","cr:269","cr:820","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=d("react").useContext;function a(a){var e=a.color;a=babelHelpers.objectWithoutPropertiesLoose(a,["color"]);var f=i(d("MAWArmadilloLink.re").context);if(f)return h.jsx(c("MAWArmadilloLink.react"),babelHelpers["extends"]({},a,{color:e}));if(b("cr:269"))return h.jsx(b("cr:269"),babelHelpers["extends"]({},a,{color:e}));return b("cr:820")?h.jsx(b("cr:820"),babelHelpers["extends"]({},a)):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LSContactReachabilityStatusType.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").zero;c=b("bs_caml_int64").one;d=[0,2];f.reachable=a;f.unreachableUserType=c;f.unreachableAdultType=d}),null);
__d("MWLSParticipantDetails.bs",["GenderConst","LSContactGender.bs","LSContactReachabilityStatusType.bs","ReQL.bs","ReQLSubscription.bs","bs_belt_Option","bs_caml","bs_caml_format","react","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");function a(a){var c=b("useReStore")();return b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(c.table("contacts")),{hd:b("bs_caml_format").caml_int64_of_string(a),tl:0}),function(a){return a.name})},[a,c]))}function c(a){var c=b("useReStore")();return b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(c.table("contacts")),{hd:b("bs_caml_format").caml_int64_of_string(a),tl:0}),function(a){return b("bs_belt_Option").getWithDefault(a.firstName,a.name)})},[a,c]))}function d(a){var c=b("useReStore")();return b("bs_belt_Option").getWithDefault(b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(c.table("contacts")),{hd:b("bs_caml_format").caml_int64_of_string(a),tl:0}),function(a){return a.secondaryName})},[a,c])))}function e(a){var c=b("useReStore")();return b("bs_belt_Option").getWithDefault(b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(c.table("contacts")),{hd:b("bs_caml_format").caml_int64_of_string(a),tl:0}),function(a){var c=a.gender,d=a.firstName;d=d!==void 0?d:a.name;a=b("bs_caml").i64_eq(c,b("LSContactGender.bs").female)?b("GenderConst").FEMALE_SINGULAR:b("bs_caml").i64_eq(c,b("LSContactGender.bs").male)?b("GenderConst").MALE_SINGULAR:b("bs_caml").i64_eq(c,b("LSContactGender.bs").neuter)?b("GenderConst").NEUTER_SINGULAR:b("GenderConst").NOT_A_PERSON;return[d,a]})},[a,c])))}function i(a){var c=b("useReStore")();return b("bs_belt_Option").getWithDefault(b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(c.table("contacts")),{hd:b("bs_caml_format").caml_int64_of_string(a),tl:0}),function(a){a=a.contactReachabilityStatusType;if(a!==void 0)return b("bs_caml").i64_eq(b("LSContactReachabilityStatusType.bs").reachable,a);else return!0})},[a,c])),!0)}f.useParticipantName=a;f.useParticipantShortName=c;f.useParticipantSecondaryName=d;f.useNameAndGender=e;f.useParticipantReachabilityStatus=i}),null);
__d("MWPThreadPreview.bs",["LS.bs","LSAuthorityLevel.bs","LSContactBlockedByViewerStatus.bs","LSContactGender.bs","LSContactIdType.bs","LSContactType.bs","LSContactViewerRelationship.bs","LSContactWorkForeignEntityType.bs","LSDatabaseType.bs","LSLocalCreateOptimisticGroupThread","LSMessagingThreadTypeUtil.bs","LSTransaction.bs","LSVec","LSVerifyContactRowExists","LSVerifyThreadRowExists","MWPActor.bs","MWPThreadTheme.bs","MWThreadKey.bs","MessagingThreadType.bs","Promise","ReQL.bs","ReQLSubscription.bs","ReQLSuspense","bs_belt_Option","bs_caml","bs_caml_array","bs_caml_option","bs_curry","bs_int64","cr:4212","promiseDone","react","recoverableViolation","stylex","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h,i=g||b("react"),j={composer:{flexShrink:"x2lah0s",minHeight:"x879a55"},container:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",fontSize:"x6prxxf",minHeight:"x2lwn1j"},preview:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",minHeight:"x2lwn1j"}};function k(a){var c=b("useReStore")();i.useEffect(function(){b("LSTransaction.bs").run(c,function(c){return b("Promise").all(a.map(function(a){return b("LSVerifyContactRowExists")(a.id,b("LSContactIdType.bs").fbid,void 0,void 0,b("LSContactType.bs").user,void 0,void 0,void 0,void 0,!1,!1,b("LSContactBlockedByViewerStatus.bs").unblocked,void 0,!1,b("LSAuthorityLevel.bs").clientPartial,void 0,void 0,b("LSContactWorkForeignEntityType.bs").unknown,b("LSContactGender.bs").unknown,b("LSContactViewerRelationship.bs").unknown,void 0,b("LS.bs").make(c))}))},"readWrite")},[c,JSON.stringify(a.map(function(a){return b("bs_int64").to_string(a.id)}))])}function l(a){var c=a.thread,d=a.renderThreadView,e=a.renderThreadPreview;a=a.children;if(e!==void 0)return b("bs_curry")._2(e,c,a);else return i.jsx(b("MWThreadKey.bs").make,{id:c.threadKey,children:i.jsxs("div",{className:(h||(h=b("stylex")))(j.container),children:[i.jsx("div",{className:h(j.preview),children:i.jsx(b("MWPThreadTheme.bs").make,{themeFbid:c.themeFbid,children:b("bs_curry")._1(d,c)})}),i.jsx("div",{className:h(j.composer),children:a})]})})}c={make:l};function m(a){var c=a.recipientToken,d=a.setPreviewThread,e=a.renderThreadView,f=a.renderThreadPreview;a=a.children;var g=b("useReStore")(),h=c.threadType,j=c.id;k([c]);i.useEffect(function(){b("promiseDone")(b("LSTransaction.bs").run(g,function(a){return b("LSVerifyThreadRowExists")(j,h,b("LSDatabaseType.bs").mailbox,b("LS.bs").make(a))},"readWrite"))},[g,b("bs_int64").to_string(j),JSON.stringify(h)]);var m=b("ReQLSubscription.bs").useFirst(i.useMemo(function(){return b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(g.table("threads")),{hd:j,tl:0})},[g,j]));i.useEffect(function(){b("bs_curry")._1(d,function(a){return m})},[m]);if(m!==void 0)return i.jsx(l,{thread:m,renderThreadView:e,renderThreadPreview:f,children:a});else return null}d={make:m};function n(a,c,d,e){var f=b("useReStore")(),g=b("bs_int64").to_string(b("MWPActor.bs").useActor()),h=b("ReQLSubscription.bs").useArray(i.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(f.table("participants")),function(a){return c.has(b("bs_int64").to_string(a.contactId))}),function(a){return b("bs_int64").to_string(a.threadKey)})},[f,c]));return b("ReQLSubscription.bs").useFirst(i.useMemo(function(){var a,d=new Set(h);return(a=b("ReQL.bs")).filter(a.filter(a.filter(a.filter(a.fromTableAscending(f.table("threads")),function(a){return b("bs_caml").i64_eq(a.threadType,e)}),function(a){return a.threadName===void 0}),function(a){a=a.clientThreadKey;if(a!==void 0)return d.has(b("bs_int64").to_string(a));else return!1}),function(a){a=a.clientThreadKey;if(a===void 0)return!1;a=b("ReQLSuspense").toArray(b("ReQL.bs").filter(b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(f.table("participants").index("threadKeyReadWatermarkTimestampMs")),{hd:a,tl:0}),function(a){return b("bs_int64").to_string(a.contactId)}),function(a){return a!==g}));if(a.every(function(a){return c.has(a)}))return a.length===c.size;else return!1})},[f,h,c,g,JSON.stringify(e)]))}function o(a,c,d,e){var f=b("useReStore")();i.useEffect(function(){a===void 0&&b("promiseDone")(b("LSTransaction.bs").run(f,function(a){if(b("bs_caml").i64_eq(c,b("MessagingThreadType.bs").group))return b("LSLocalCreateOptimisticGroupThread")(b("LSVec").make(d.map(function(a){return a.id})),void 0,e,b("LS.bs").make(a)).then(function(a){});else if(b("LSMessagingThreadTypeUtil.bs").isSecure(c))if(b("cr:4212")==null)return b("Promise").resolve();else return b("bs_curry")._3(b("cr:4212").call,a,d,c).then(function(a){});else{b("recoverableViolation")("Don't know how to create optimistic thread for thread of thread type"+b("bs_belt_Option").getWithDefault(JSON.stringify(c),""),"messenger_web_product");return b("Promise").resolve()}},"readWrite"))},[f,d,JSON.stringify(a),JSON.stringify(c)])}function p(a){var c=a.tokens,d=a.tokensExcludingActor,e=a.tokenContactIdsExcludingActor,f=a.setPreviewThread,g=a.threadType,h=a.renderThreadView,j=a.renderThreadPreview,m=a.checkExistingThreads;a=a.children;var p=n(d,e,f,g);k(d);o(p,g,c,m);i.useEffect(function(){b("bs_curry")._1(f,function(a){return p})});if(p!==void 0)return i.jsx(l,{thread:p,renderThreadView:h,renderThreadPreview:j,children:a});else return null}var q={make:p,useCreateOptimisticThreadForTokens:o,useFindMatchingOptimisticThreadWithParticipants:n};function r(a,c,d,e,f){var g=b("useReStore")(),h=b("bs_int64").to_string(b("MWPActor.bs").useActor()),j=b("ReQLSubscription.bs").useArray(i.useMemo(function(){return b("ReQL.bs").map(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(g.table("participants")),function(a){return c.has(b("bs_int64").to_string(a.contactId))}),function(a){return b("bs_int64").to_string(a.threadKey)})},[g,c]));return b("ReQLSubscription.bs").useFirst(i.useMemo(function(){var a,d=new Set(j);return(a=b("ReQL.bs")).filter(a.filter(a.filter(a.filter(a.filter(a.fromTableAscending(g.table("threads")),function(a){return b("bs_caml").i64_eq(a.threadType,e)}),function(a){return a.threadName===void 0}),function(a){if(f)return!0;else return b("bs_caml").i64_eq(a.authorityLevel,b("LSAuthorityLevel.bs").optimistic)}),function(a){return d.has(b("bs_int64").to_string(a.threadKey))}),function(a){a=b("ReQLSuspense").toArray(b("ReQL.bs").map(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(g.table("participants").index("threadKeyReadWatermarkTimestampMs")),{hd:a.threadKey,tl:0}),function(a){return b("bs_int64").to_string(a.contactId)}));var d=a.filter(function(a){return a!==h});if(a.length===d.length||d.length!==c.size)return!1;else return d.every(function(a){return c.has(a)})})},[g,j,c,h,JSON.stringify(e)]))}function s(a){var c=a.tokensExcludingActor,d=a.tokens,e=a.threadType,f=a.setPreviewThread,g=a.renderThreadView,h=a.renderThreadPreview,j=a.checkExistingThreads;a=a.children;var k=i.useMemo(function(){return new Set(c.map(function(a){return b("bs_int64").to_string(a.id)}))},[c]),m=r(c,k,f,e,j);i.useEffect(function(){m!==void 0&&b("bs_curry")._1(f,function(a){return m})},[m]);if(m!==void 0)return i.jsx(l,{thread:m,renderThreadView:g,renderThreadPreview:h,children:a});else return i.jsx(p,{tokens:d,tokensExcludingActor:c,tokenContactIdsExcludingActor:k,setPreviewThread:f,threadType:e,renderThreadView:g,renderThreadPreview:h,checkExistingThreads:j,children:a})}var t={make:s,useFindExistingThreadWithTokens:r};function a(a){var c=a.tokens,d=a.areWeCreatingASecureThread,e=a.setPreviewThread,f=a.nullstate,g=a.renderThreadView,h=a.renderThreadPreview,j=a.checkExistingThreads;a=a.children;f=f!==void 0?b("bs_caml_option").valFromOption(f):null;j=j!==void 0?j:!0;var k=b("MWPActor.bs").useActor(),l=i.useMemo(function(){return c.filter(function(a){return b("bs_caml").i64_neq(a.id,k)})},[c,k]);i.useEffect(function(){c.length===0&&b("bs_curry")._1(e,function(a){})},[c]);if(c.length===0)return f;var n=l.length;if(n!==1){if(n===0)if(d)return f;else return i.jsx(m,{recipientToken:b("bs_caml_array").get(c,0),setPreviewThread:e,renderThreadView:g,renderThreadPreview:h,children:a})}else{n=l[0];if(j)if(d)return i.jsx(s,{tokensExcludingActor:l,tokens:c,threadType:b("MessagingThreadType.bs").secureMessageOverWaOneToOne,setPreviewThread:e,renderThreadView:g,renderThreadPreview:h,checkExistingThreads:j,children:a});else return i.jsx(m,{recipientToken:n,setPreviewThread:e,renderThreadView:g,renderThreadPreview:h,children:a})}return i.jsx(s,{tokensExcludingActor:l,tokens:c,threadType:d?b("MessagingThreadType.bs").secureMessageOverWaGroup:b("MessagingThreadType.bs").group,setPreviewThread:e,renderThreadView:g,renderThreadPreview:h,checkExistingThreads:j,children:a})}a.displayName=a.name+" [from "+e.id+"]";e=b("cr:4212");a=a;f.$MAWCreateOptimisticSecureThread$requireCondXplat=b("cr:4212");f.mawCreateOptimisticSecureThread=e;f.styles=j;f.ExistingThreadPreview=c;f.CanonicalThreadPreview=d;f.OptimisticThread=q;f.PossiblyOptimisticThread=t;f.make=a}),null);